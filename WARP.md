# WARP.md

This file provides guidance to WARP (warp.dev) when working with code in this repository.

## Project Overview

This is an AI-powered interview preparation PWA built with Next.js 15, TypeScript, and OpenAI. It provides real-time speech recognition, AI-generated questions, and comprehensive feedback for job interview practice.

## Key Commands

### Development
```bash
# Start development server
npm run dev

# Build for production
npm run build

# Run production build locally
npm start

# Lint code
npm run lint
```

### Database Setup
```bash
# Run Supabase migrations (required for auth)
npx supabase migration up

# Start local Supabase instance (if using local development)
npx supabase start
```

### PWA & Icons
```bash
# Generate PWA icons (if script exists)
node scripts/generate-icons.js

# Test PWA functionality (production build required)
npm run build && npm start
# Then open in browser and test installation
```

## Architecture Overview

### Core Technologies
- **Frontend**: Next.js 15 (App Router), React 19, TypeScript
- **Styling**: Tailwind CSS v4, Radix UI components
- **AI Services**: OpenAI GPT-4 for question generation and feedback
- **Speech**: Web Speech API for STT/TTS
- **Auth**: Supabase Auth with Google OAuth
- **PWA**: next-pwa with service workers
- **State**: React hooks, localStorage for offline

### Key Service Layer (`/lib`)
- `openai.ts` - AI question generation and response evaluation
- `speech.ts` - Speech recognition and synthesis wrapper
- `supabase/` - Auth and database client setup
- `offline-storage.ts` - IndexedDB/localStorage for offline functionality
- `session-manager.ts` - Interview session orchestration
- `scoring-system.ts` - Multi-dimensional evaluation algorithms

### Component Architecture (`/components`)
- **Interview Flow**: `interview-setup.tsx` → `interview-session.tsx` → `ai-feedback.tsx`
- **Voice Processing**: `voice-recorder.tsx` + `ai-interviewer.tsx` (TTS)
- **Recording**: `session-recorder.tsx` - Audio/video capture
- **Analytics**: `analytics-dashboard.tsx` - Performance tracking
- **PWA**: `pwa-install-prompt.tsx` + `offline-indicator.tsx`

### Data Flow
1. User selects interview parameters → Creates session via `SessionManager`
2. Questions generated by OpenAI or loaded from cache/templates
3. Speech recognition captures responses → Real-time transcription
4. AI evaluates responses → Provides feedback and scoring
5. Session data saved to localStorage/IndexedDB for offline access

## Environment Configuration

Required environment variables (copy `.env.example` to `.env.local`):
```bash
# OpenAI API (Required for AI features)
OPENAI_API_KEY=your_api_key_here

# Supabase (Required for authentication)
NEXT_PUBLIC_SUPABASE_URL=your_supabase_url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your_anon_key
SUPABASE_SERVICE_ROLE_KEY=your_service_role_key  # Only for server-side

# App URL
NEXT_PUBLIC_APP_URL=http://localhost:3000
```

## Critical Implementation Details

### OpenAI Integration
- Uses GPT-4o-mini model for cost efficiency
- JSON response format enforced for structured data
- Fallback to cached questions when offline or API fails
- Rate limiting considerations for production

### Speech Processing
- Continuous recognition with interim results
- Fallback for browsers without Web Speech API
- Voice synthesis with customizable voices/speed/pitch
- Audio level visualization for user feedback

### PWA & Offline
- Service worker caches all static assets
- API responses cached with StaleWhileRevalidate
- Interview sessions work completely offline
- Sync mechanism when back online

### Authentication Flow
1. User signs up/in with Google OAuth
2. Redirected to username setup if first time
3. Profile created in `user_profiles` table
4. Session managed via Supabase Auth cookies

## Database Schema (Supabase)

### Key Tables
- `email_verification_tokens` - Custom email verification
- `user_profiles` - Extended user data with username
- Auth tables managed by Supabase

### Migrations
Located in `/supabase/migrations/`:
- `001_email_verification_tokens.sql`
- `002_user_profiles.sql`

## Interview Templates

Pre-built templates in `/data/interview-templates.ts`:
- Frontend Developer
- Backend Engineer
- Full Stack Developer
- Product Manager
- Data Scientist
- DevOps Engineer
- Behavioral Interview

## Common Development Tasks

### Adding New Question Types
1. Update types in `/types/interview.ts`
2. Modify question generation in `/lib/openai.ts`
3. Update templates in `/data/interview-templates.ts`
4. Adjust UI in `/components/question-display.tsx`

### Customizing AI Feedback
- Modify evaluation criteria in `/lib/openai.ts` → `evaluateResponse()`
- Adjust scoring dimensions in `/lib/scoring-system.ts`
- Update feedback UI in `/components/ai-feedback.tsx`

### Testing Speech Features
- Chrome/Edge recommended for best compatibility
- HTTPS required in production (localhost works)
- Test with different accents/speeds in voice settings
- Check offline fallbacks by disabling network

## Debugging Tips

### Common Issues
1. **Speech not working**: Check browser compatibility and permissions
2. **AI not responding**: Verify OPENAI_API_KEY is set correctly
3. **Auth failing**: Check Supabase URLs and keys match your project
4. **PWA not installing**: Ensure HTTPS and valid manifest.json
5. **Offline not working**: Check service worker registration in devtools

### Browser DevTools
- Application tab: Check service worker, manifest, storage
- Network tab: Monitor API calls and caching behavior
- Console: Watch for speech API errors or permissions issues

## Performance Considerations

- OpenAI API calls are expensive - implement proper caching
- Speech recognition is resource-intensive - provide pause/stop controls
- Large audio recordings consume storage - implement cleanup
- PWA assets can be large - optimize images and lazy load

## Security Notes

- OpenAI API key should never be exposed to client (currently using `dangerouslyAllowBrowser: true` for development)
- Implement proper rate limiting for production
- Sanitize all user inputs before sending to AI
- Use Supabase RLS policies for data access control
